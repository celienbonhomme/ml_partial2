
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Ejercicio 4 &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'exo4';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Ejercicio 3" href="exo3.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Parcial practico 2
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="exo1_cancer.html">Ejercicio 1: Breast cancer</a></li>
<li class="toctree-l1"><a class="reference internal" href="exo1_housing.html">Ejercicio 1: Boston Housing</a></li>
<li class="toctree-l1"><a class="reference internal" href="exo2_fraud.html">Ejercicio 2: Fraud detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="exo2_wind.html">Ejercicio 2: Wind speed</a></li>
<li class="toctree-l1"><a class="reference internal" href="exo3.html">Ejercicio 3</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">Ejercicio 4</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fexo4.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/exo4.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Ejercicio 4</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-dataset-already-processed">Loading Dataset, already processed</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-models-and-their-parameters">Defining models and their parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tuning-models-and-training-them">Tuning models and training them</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="ejercicio-4">
<h1>Ejercicio 4<a class="headerlink" href="#ejercicio-4" title="Link to this heading">#</a></h1>
<section id="loading-dataset-already-processed">
<h2>Loading Dataset, already processed<a class="headerlink" href="#loading-dataset-already-processed" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfWind</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/data_wind_imputed.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfWind</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Hora</th>
      <th>Dirección del viento horaria (gr)</th>
      <th>Velocidad horario del viento (m/s)</th>
      <th>Máxima ráfaga de viento (m/s)</th>
      <th>Fecha</th>
      <th>Humedad rel. máx. hora anterior (AUT)</th>
      <th>Humedad rel. mín. hora anterior (AUT)</th>
      <th>Temperatura máx. hora anterior (AUT) (K)</th>
      <th>Temperatura mín. hora anterior (AUT) (K)</th>
      <th>Humedad relativa horaria</th>
      <th>Presión atmosférica a nivel de estación, horaria (Pa)</th>
      <th>Precipitación total por hora (m)</th>
      <th>Presión atmosférica máx. hora anterior (AUT) (Pa)</th>
      <th>Presión atmosférica mín. hora anterior (AUT) (Pa)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12</td>
      <td>0.809017</td>
      <td>1.8</td>
      <td>3.8</td>
      <td>2000-01-01 12:00:00</td>
      <td>0.69</td>
      <td>0.60</td>
      <td>295.75</td>
      <td>293.85</td>
      <td>0.61</td>
      <td>88820.0</td>
      <td>0.0</td>
      <td>88820.0</td>
      <td>88770.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>13</td>
      <td>0.965926</td>
      <td>2.7</td>
      <td>4.7</td>
      <td>2000-01-01 13:00:00</td>
      <td>0.62</td>
      <td>0.55</td>
      <td>297.35</td>
      <td>295.65</td>
      <td>0.55</td>
      <td>88840.0</td>
      <td>0.0</td>
      <td>88840.0</td>
      <td>88820.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>14</td>
      <td>0.891007</td>
      <td>2.0</td>
      <td>4.9</td>
      <td>2000-01-01 14:00:00</td>
      <td>0.56</td>
      <td>0.50</td>
      <td>298.65</td>
      <td>297.45</td>
      <td>0.51</td>
      <td>88810.0</td>
      <td>0.0</td>
      <td>88840.0</td>
      <td>88810.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>15</td>
      <td>0.848048</td>
      <td>2.5</td>
      <td>5.8</td>
      <td>2000-01-01 15:00:00</td>
      <td>0.52</td>
      <td>0.44</td>
      <td>300.55</td>
      <td>298.15</td>
      <td>0.44</td>
      <td>88740.0</td>
      <td>0.0</td>
      <td>88810.0</td>
      <td>88740.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>16</td>
      <td>0.224951</td>
      <td>2.4</td>
      <td>5.8</td>
      <td>2000-01-01 16:00:00</td>
      <td>0.50</td>
      <td>0.43</td>
      <td>300.25</td>
      <td>298.65</td>
      <td>0.46</td>
      <td>88650.0</td>
      <td>0.0</td>
      <td>88740.0</td>
      <td>88650.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfWind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>90276
</pre></div>
</div>
</div>
</div>
</section>
<section id="defining-models-and-their-parameters">
<h2>Defining models and their parameters<a class="headerlink" href="#defining-models-and-their-parameters" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span><span class="p">,</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>

<span class="n">grid_nb</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">model_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">model_dict</span><span class="p">[</span><span class="s1">&#39;Bayesan Ridge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">BayesianRidge</span><span class="p">(),</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model__alpha_1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">]},</span> <span class="s1">&#39;MAPE_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;R2_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;RMSE_score&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">model_dict</span><span class="p">[</span><span class="s1">&#39;Decision Tree&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model__max_depth&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span><span class="s1">&#39;model__min_samples_split&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)},</span> <span class="s1">&#39;MAPE_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;R2_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;RMSE_score&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">model_dict</span><span class="p">[</span><span class="s1">&#39;Random Forest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model__max_depth&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span><span class="s1">&#39;model__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]},</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="s1">&#39;MAPE_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;R2_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;RMSE_score&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">model_dict</span><span class="p">[</span><span class="s1">&#39;Gradient Boosting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model__max_depth&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> <span class="p">,</span><span class="s1">&#39;model__min_samples_split&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)},</span> <span class="s1">&#39;MAPE_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;R2_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;RMSE_score&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">model_dict</span><span class="p">[</span><span class="s1">&#39;Knn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">KNeighborsRegressor</span><span class="p">(),</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model__n_neighbors&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)},</span> <span class="s1">&#39;MAPE_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;R2_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;RMSE_score&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">model_dict</span><span class="p">[</span><span class="s1">&#39;Ridge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">Ridge</span><span class="p">(),</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">]},</span> <span class="s1">&#39;MAPE_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;R2_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;RMSE_score&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">model_dict</span><span class="p">[</span><span class="s1">&#39;Lasso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">Lasso</span><span class="p">(),</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">]},</span> <span class="s1">&#39;MAPE_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;R2_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;RMSE_score&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model_info</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;MAPE_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;R2_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;RMSE_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">number_of_days</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span>

<span class="n">model_dict</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Bayesan Ridge&#39;: {&#39;model&#39;: BayesianRidge(),
  &#39;grid&#39;: {&#39;model__alpha_1&#39;: [1e-06, 1e-05, 0.0001, 0.001, 0.01, 0.1]},
  &#39;MAPE_score&#39;: [],
  &#39;R2_score&#39;: [],
  &#39;RMSE_score&#39;: []},
 &#39;Decision Tree&#39;: {&#39;model&#39;: DecisionTreeRegressor(random_state=42),
  &#39;grid&#39;: {&#39;model__max_depth&#39;: (1, 20),
   &#39;model__min_samples_split&#39;: (0.1, 1.0)},
  &#39;MAPE_score&#39;: [],
  &#39;R2_score&#39;: [],
  &#39;RMSE_score&#39;: []},
 &#39;Random Forest&#39;: {&#39;model&#39;: RandomForestRegressor(random_state=42),
  &#39;grid&#39;: {&#39;model__max_depth&#39;: (1, 20),
   &#39;model__n_estimators&#39;: [100, 200, 300]},
  &#39;n_estimators&#39;: range(1, 20),
  &#39;MAPE_score&#39;: [],
  &#39;R2_score&#39;: [],
  &#39;RMSE_score&#39;: []},
 &#39;Gradient Boosting&#39;: {&#39;model&#39;: GradientBoostingRegressor(random_state=42),
  &#39;grid&#39;: {&#39;model__max_depth&#39;: (1, 20),
   &#39;model__min_samples_split&#39;: (0.1, 1.0)},
  &#39;MAPE_score&#39;: [],
  &#39;R2_score&#39;: [],
  &#39;RMSE_score&#39;: []},
 &#39;Knn&#39;: {&#39;model&#39;: KNeighborsRegressor(),
  &#39;grid&#39;: {&#39;model__n_neighbors&#39;: (1, 20)},
  &#39;MAPE_score&#39;: [],
  &#39;R2_score&#39;: [],
  &#39;RMSE_score&#39;: []},
 &#39;Ridge&#39;: {&#39;model&#39;: Ridge(),
  &#39;grid&#39;: {&#39;model__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100, 1000]},
  &#39;MAPE_score&#39;: [],
  &#39;R2_score&#39;: [],
  &#39;RMSE_score&#39;: []},
 &#39;Lasso&#39;: {&#39;model&#39;: Lasso(),
  &#39;grid&#39;: {&#39;model__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100, 1000]},
  &#39;MAPE_score&#39;: [],
  &#39;R2_score&#39;: [],
  &#39;RMSE_score&#39;: []}}
</pre></div>
</div>
</div>
</div>
<p>I instantiated a dictionary of models containg their parameters and their future scores so that it will be easier to manage them later on</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model_info</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">days</span> <span class="ow">in</span> <span class="n">number_of_days</span><span class="p">:</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="n">days</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;y_pred&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;y_test&#39;</span><span class="p">:</span> <span class="p">[]}</span>
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">number_of_days</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7, 14, 21, 28]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfWind</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Hora</th>
      <th>Dirección del viento horaria (gr)</th>
      <th>Velocidad horario del viento (m/s)</th>
      <th>Máxima ráfaga de viento (m/s)</th>
      <th>Fecha</th>
      <th>Humedad rel. máx. hora anterior (AUT)</th>
      <th>Humedad rel. mín. hora anterior (AUT)</th>
      <th>Temperatura máx. hora anterior (AUT) (K)</th>
      <th>Temperatura mín. hora anterior (AUT) (K)</th>
      <th>Humedad relativa horaria</th>
      <th>Presión atmosférica a nivel de estación, horaria (Pa)</th>
      <th>Precipitación total por hora (m)</th>
      <th>Presión atmosférica máx. hora anterior (AUT) (Pa)</th>
      <th>Presión atmosférica mín. hora anterior (AUT) (Pa)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12</td>
      <td>0.809017</td>
      <td>1.8</td>
      <td>3.8</td>
      <td>2000-01-01 12:00:00</td>
      <td>0.69</td>
      <td>0.60</td>
      <td>295.75</td>
      <td>293.85</td>
      <td>0.61</td>
      <td>88820.0</td>
      <td>0.0</td>
      <td>88820.0</td>
      <td>88770.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>13</td>
      <td>0.965926</td>
      <td>2.7</td>
      <td>4.7</td>
      <td>2000-01-01 13:00:00</td>
      <td>0.62</td>
      <td>0.55</td>
      <td>297.35</td>
      <td>295.65</td>
      <td>0.55</td>
      <td>88840.0</td>
      <td>0.0</td>
      <td>88840.0</td>
      <td>88820.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>14</td>
      <td>0.891007</td>
      <td>2.0</td>
      <td>4.9</td>
      <td>2000-01-01 14:00:00</td>
      <td>0.56</td>
      <td>0.50</td>
      <td>298.65</td>
      <td>297.45</td>
      <td>0.51</td>
      <td>88810.0</td>
      <td>0.0</td>
      <td>88840.0</td>
      <td>88810.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>15</td>
      <td>0.848048</td>
      <td>2.5</td>
      <td>5.8</td>
      <td>2000-01-01 15:00:00</td>
      <td>0.52</td>
      <td>0.44</td>
      <td>300.55</td>
      <td>298.15</td>
      <td>0.44</td>
      <td>88740.0</td>
      <td>0.0</td>
      <td>88810.0</td>
      <td>88740.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>16</td>
      <td>0.224951</td>
      <td>2.4</td>
      <td>5.8</td>
      <td>2000-01-01 16:00:00</td>
      <td>0.50</td>
      <td>0.43</td>
      <td>300.25</td>
      <td>298.65</td>
      <td>0.46</td>
      <td>88650.0</td>
      <td>0.0</td>
      <td>88740.0</td>
      <td>88650.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="tuning-models-and-training-them">
<h2>Tuning models and training them<a class="headerlink" href="#tuning-models-and-training-them" title="Link to this heading">#</a></h2>
<p>Using BayesSearchCV i tune the models by searching for the best paramaters with bayesan optimization, this chunk of code takes every model out of the dictionary and finds the best hyperparameters for every possible scenario (in this case the number of days), so that we get the best parameters for every possible way of validation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.discriminant_analysis</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">skopt</span> <span class="kn">import</span> <span class="n">BayesSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="c1"># Create an empty dictionary to store the best parameters for each model</span>
<span class="n">best_params</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">best_params</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;model_ready&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># Iterate over the models and perform parameter search</span>
<span class="k">for</span> <span class="n">numDays</span> <span class="ow">in</span> <span class="n">number_of_days</span><span class="p">:</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">dfWind</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">numDays</span><span class="o">*</span><span class="mi">24</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Velocidad horario del viento (m/s)&#39;</span><span class="p">,</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">dfWind</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">numDays</span><span class="o">*</span><span class="mi">24</span><span class="p">][</span><span class="s1">&#39;Velocidad horario del viento (m/s)&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">]))])</span>
        <span class="c1"># Get the parameter search space for the current model</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;grid&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># Create the BayesSearchCV object for the current model</span>
        <span class="n">search_cv</span> <span class="o">=</span> <span class="n">BayesSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        
        <span class="c1"># Fit the BayesSearchCV object to find the best parameters</span>
        <span class="n">search_cv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        
        <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;model_ready&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">search_cv</span><span class="p">)</span>
        <span class="c1"># Store the best parameters for the current model</span>
        <span class="n">best_params</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">search_cv</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best parameters for </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2"> and with </span><span class="si">{</span><span class="n">numDays</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">search_cv</span><span class="o">.</span><span class="n">best_params_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best parameters for Bayesan Ridge and with 7: OrderedDict([(&#39;model__alpha_1&#39;, 1e-06)])
Best parameters for Decision Tree and with 7: OrderedDict([(&#39;model__max_depth&#39;, 20), (&#39;model__min_samples_split&#39;, 0.11062015474561707)])
Best parameters for Random Forest and with 7: OrderedDict([(&#39;model__max_depth&#39;, 8), (&#39;model__n_estimators&#39;, 300)])
Best parameters for Gradient Boosting and with 7: OrderedDict([(&#39;model__max_depth&#39;, 20), (&#39;model__min_samples_split&#39;, 0.8204021876822672)])
Best parameters for Knn and with 7: OrderedDict([(&#39;model__n_neighbors&#39;, 6)])
Best parameters for Ridge and with 7: OrderedDict([(&#39;model__alpha&#39;, 1)])
Best parameters for Lasso and with 7: OrderedDict([(&#39;model__alpha&#39;, 0.01)])
Best parameters for Bayesan Ridge and with 14: OrderedDict([(&#39;model__alpha_1&#39;, 0.1)])
Best parameters for Decision Tree and with 14: OrderedDict([(&#39;model__max_depth&#39;, 20), (&#39;model__min_samples_split&#39;, 0.13215550011886387)])
Best parameters for Random Forest and with 14: OrderedDict([(&#39;model__max_depth&#39;, 5), (&#39;model__n_estimators&#39;, 300)])
Best parameters for Gradient Boosting and with 14: OrderedDict([(&#39;model__max_depth&#39;, 1), (&#39;model__min_samples_split&#39;, 0.8360470176973764)])
Best parameters for Knn and with 14: OrderedDict([(&#39;model__n_neighbors&#39;, 13)])
Best parameters for Ridge and with 14: OrderedDict([(&#39;model__alpha&#39;, 1)])
Best parameters for Lasso and with 14: OrderedDict([(&#39;model__alpha&#39;, 0.01)])
Best parameters for Bayesan Ridge and with 21: OrderedDict([(&#39;model__alpha_1&#39;, 0.1)])
Best parameters for Decision Tree and with 21: OrderedDict([(&#39;model__max_depth&#39;, 11), (&#39;model__min_samples_split&#39;, 0.3138922057186223)])
Best parameters for Random Forest and with 21: OrderedDict([(&#39;model__max_depth&#39;, 3), (&#39;model__n_estimators&#39;, 200)])
Best parameters for Gradient Boosting and with 21: OrderedDict([(&#39;model__max_depth&#39;, 1), (&#39;model__min_samples_split&#39;, 0.8360470176973764)])
Best parameters for Knn and with 21: OrderedDict([(&#39;model__n_neighbors&#39;, 8)])
Best parameters for Ridge and with 21: OrderedDict([(&#39;model__alpha&#39;, 1)])
Best parameters for Lasso and with 21: OrderedDict([(&#39;model__alpha&#39;, 0.01)])
Best parameters for Bayesan Ridge and with 28: OrderedDict([(&#39;model__alpha_1&#39;, 1e-06)])
Best parameters for Decision Tree and with 28: OrderedDict([(&#39;model__max_depth&#39;, 5), (&#39;model__min_samples_split&#39;, 0.1)])
Best parameters for Random Forest and with 28: OrderedDict([(&#39;model__max_depth&#39;, 6), (&#39;model__n_estimators&#39;, 200)])
Best parameters for Gradient Boosting and with 28: OrderedDict([(&#39;model__max_depth&#39;, 12), (&#39;model__min_samples_split&#39;, 0.9330123566255528)])
Best parameters for Knn and with 28: OrderedDict([(&#39;model__n_neighbors&#39;, 13)])
Best parameters for Ridge and with 28: OrderedDict([(&#39;model__alpha&#39;, 1)])
Best parameters for Lasso and with 28: OrderedDict([(&#39;model__alpha&#39;, 0.001)])
</pre></div>
</div>
</div>
</div>
<p>How we can see every model has different best hyperparamaters for every scenario of validation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for model in model_dict.keys():</span>
<span class="c1">#     for param in best_params[model]:</span>
<span class="c1">#         for key in param.keys():</span>
<span class="c1">#             print(key)</span>
<span class="c1">#             param[key[6:]] = param.pop(key)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we will train every model for each scenario, using (7,14,21,28) days as training dataset and the following day as validation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a list to store the trained models</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.discriminant_analysis</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_percentage_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">clone</span>


<span class="n">trained_models</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Iterate over each model and train them</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Training </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">])])</span>
    <span class="n">rmse_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mape_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">r2_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n_days</span> <span class="ow">in</span> <span class="n">number_of_days</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Training </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1"> with </span><span class="si">{</span><span class="n">n_days</span><span class="si">}</span><span class="s1"> days...&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dfWind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">n_days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">):</span>
            <span class="n">model_tmp</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;model_ready&#39;</span><span class="p">][</span><span class="n">number_of_days</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">n_days</span><span class="p">)])</span>
            <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">])])</span>
            <span class="n">X_train</span> <span class="o">=</span> <span class="n">dfWind</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">n_days</span><span class="o">*</span><span class="mi">24</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Velocidad horario del viento (m/s)&#39;</span><span class="p">,</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">y_train</span> <span class="o">=</span> <span class="n">dfWind</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">n_days</span><span class="o">*</span><span class="mi">24</span><span class="p">][</span><span class="s1">&#39;Velocidad horario del viento (m/s)&#39;</span><span class="p">]</span>            
            <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
            <span class="n">X_valid</span> <span class="o">=</span> <span class="n">dfWind</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">n_days</span><span class="o">*</span><span class="mi">24</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="p">((</span><span class="n">n_days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">24</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Velocidad horario del viento (m/s)&#39;</span><span class="p">,</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">y_valid</span> <span class="o">=</span> <span class="n">dfWind</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">n_days</span><span class="o">*</span><span class="mi">24</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="p">((</span><span class="n">n_days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">24</span><span class="p">)][</span><span class="s1">&#39;Velocidad horario del viento (m/s)&#39;</span><span class="p">]</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_valid</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">)</span>
            <span class="n">y_true</span> <span class="o">=</span> <span class="n">y_valid</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid</span><span class="p">)</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">n_days</span><span class="p">][</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">n_days</span><span class="p">][</span><span class="s1">&#39;y_test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
            <span class="n">rmse_score</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
            <span class="n">mape_score</span> <span class="o">=</span> <span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
            <span class="n">r2_score_tmp</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
            <span class="n">rmse_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse_score</span><span class="p">)</span>
            <span class="n">mape_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mape_score</span><span class="p">)</span>
            <span class="n">r2_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r2_score_tmp</span><span class="p">)</span>
        <span class="c1"># Save the scores</span>
        <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;MAPE_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mape_scores</span><span class="p">))</span>
        <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;R2_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r2_scores</span><span class="p">))</span>
        <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;RMSE_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmse_scores</span><span class="p">))</span>
        <span class="n">rmse_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mape_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">r2_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">trained_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1"> trained!&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MAPE: </span><span class="si">{</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s2">&quot;MAPE_score&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;R2: </span><span class="si">{</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s2">&quot;R2_score&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RMSE: </span><span class="si">{</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s2">&quot;RMSE_score&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training Bayesan Ridge...
Training Bayesan Ridge with 7 days...
Bayesan Ridge trained!
MAPE: [73898798301139.05]
R2: [-0.06712612345592733]
RMSE: [1.2550013476282504]
Training Bayesan Ridge with 14 days...
Bayesan Ridge trained!
MAPE: [73898798301139.05, 68914432611756.83]
R2: [-0.06712612345592733, 0.26625958763597585]
RMSE: [1.2550013476282504, 0.7262360716599138]
Training Bayesan Ridge with 21 days...
Bayesan Ridge trained!
MAPE: [73898798301139.05, 68914432611756.83, 67492324032848.99]
R2: [-0.06712612345592733, 0.26625958763597585, 0.09949856424185008]
RMSE: [1.2550013476282504, 0.7262360716599138, 0.6554768651759865]
Training Bayesan Ridge with 28 days...
Bayesan Ridge trained!
MAPE: [73898798301139.05, 68914432611756.83, 67492324032848.99, 67383275300127.99]
R2: [-0.06712612345592733, 0.26625958763597585, 0.09949856424185008, 0.22216342362020222]
RMSE: [1.2550013476282504, 0.7262360716599138, 0.6554768651759865, 0.6075941838352815]
Training Decision Tree...
Training Decision Tree with 7 days...
Decision Tree trained!
MAPE: [75993161818493.97]
R2: [0.16318669499555646]
RMSE: [0.7562809728604636]
Training Decision Tree with 14 days...
Decision Tree trained!
MAPE: [75993161818493.97, 68944164300369.695]
R2: [0.16318669499555646, 0.20369849193354944]
RMSE: [0.7562809728604636, 0.7132162433731707]
Training Decision Tree with 21 days...
Decision Tree trained!
MAPE: [75993161818493.97, 68944164300369.695, 66622691169241.414]
R2: [0.16318669499555646, 0.20369849193354944, 0.21951697490572006]
RMSE: [0.7562809728604636, 0.7132162433731707, 0.700200386300988]
Training Decision Tree with 28 days...
Decision Tree trained!
MAPE: [75993161818493.97, 68944164300369.695, 66622691169241.414, 63014998799113.46]
R2: [0.16318669499555646, 0.20369849193354944, 0.21951697490572006, 0.22474763368950135]
RMSE: [0.7562809728604636, 0.7132162433731707, 0.700200386300988, 0.6952352915986022]
Training Random Forest...
Training Random Forest with 7 days...
Random Forest trained!
MAPE: [81465836579909.05]
R2: [0.5406801886556266]
RMSE: [0.42454057499538567]
Training Random Forest with 14 days...
Random Forest trained!
MAPE: [81465836579909.05, 71959590055394.88]
R2: [0.5406801886556266, 0.5783187534413512]
RMSE: [0.42454057499538567, 0.389371465164454]
Training Random Forest with 21 days...
Random Forest trained!
MAPE: [81465836579909.05, 71959590055394.88, 69558521791646.06]
R2: [0.5406801886556266, 0.5783187534413512, 0.5890122202460786]
RMSE: [0.42454057499538567, 0.389371465164454, 0.37841497904252713]
Training Random Forest with 28 days...
Random Forest trained!
MAPE: [81465836579909.05, 71959590055394.88, 69558521791646.06, 66827294760542.74]
R2: [0.5406801886556266, 0.5783187534413512, 0.5890122202460786, 0.597841500556488]
RMSE: [0.42454057499538567, 0.389371465164454, 0.37841497904252713, 0.3706740962470798]
Training Gradient Boosting...
Training Gradient Boosting with 7 days...
Gradient Boosting trained!
MAPE: [79415001197583.97]
R2: [0.5029183398773868]
RMSE: [0.46016006518043573]
Training Gradient Boosting with 14 days...
Gradient Boosting trained!
MAPE: [79415001197583.97, 71893518789688.72]
R2: [0.5029183398773868, 0.5595047123074258]
RMSE: [0.46016006518043573, 0.4075631481985184]
Training Gradient Boosting with 21 days...
Gradient Boosting trained!
MAPE: [79415001197583.97, 71893518789688.72, 70574813411335.17]
R2: [0.5029183398773868, 0.5595047123074258, 0.5846994229105581]
RMSE: [0.46016006518043573, 0.4075631481985184, 0.38327417006070996]
Training Gradient Boosting with 28 days...
Gradient Boosting trained!
MAPE: [79415001197583.97, 71893518789688.72, 70574813411335.17, 69045558225119.32]
R2: [0.5029183398773868, 0.5595047123074258, 0.5846994229105581, 0.5991204201913948]
RMSE: [0.46016006518043573, 0.4075631481985184, 0.38327417006070996, 0.3698219701238626]
Training Knn...
Training Knn with 7 days...
Knn trained!
MAPE: [118230725086260.19]
R2: [0.16253721240165228]
RMSE: [0.7655407333533388]
Training Knn with 14 days...
Knn trained!
MAPE: [118230725086260.19, 108633253360282.53]
R2: [0.16253721240165228, 0.27626620698655907]
RMSE: [0.7655407333533388, 0.6583301264890035]
Training Knn with 21 days...
Knn trained!
MAPE: [118230725086260.19, 108633253360282.53, 104740062639445.05]
R2: [0.16253721240165228, 0.27626620698655907, 0.3327846713942044]
RMSE: [0.7655407333533388, 0.6583301264890035, 0.6052427104481826]
Training Knn with 28 days...
Knn trained!
MAPE: [118230725086260.19, 108633253360282.53, 104740062639445.05, 101870089615838.69]
R2: [0.16253721240165228, 0.27626620698655907, 0.3327846713942044, 0.36469743719796566]
RMSE: [0.7655407333533388, 0.6583301264890035, 0.6052427104481826, 0.5774211622509806]
Training Ridge...
Training Ridge with 7 days...
Ridge trained!
MAPE: [73164011537919.77]
R2: [-0.16579407672246332]
RMSE: [1.4662393697494618]
Training Ridge with 14 days...
Ridge trained!
MAPE: [73164011537919.77, 68381511198469.91]
R2: [-0.16579407672246332, 0.24687739078321985]
RMSE: [1.4662393697494618, 0.7869598540809531]
Training Ridge with 21 days...
Ridge trained!
MAPE: [73164011537919.77, 68381511198469.91, 67065877316615.7]
R2: [-0.16579407672246332, 0.24687739078321985, 0.12943358088385232]
RMSE: [1.4662393697494618, 0.7869598540809531, 0.648804471255127]
Training Ridge with 28 days...
Ridge trained!
MAPE: [73164011537919.77, 68381511198469.91, 67065877316615.7, 67043805393289.1]
R2: [-0.16579407672246332, 0.24687739078321985, 0.12943358088385232, 0.22893309961650873]
RMSE: [1.4662393697494618, 0.7869598540809531, 0.648804471255127, 0.6143736697358341]
Training Lasso...
Training Lasso with 7 days...
Lasso trained!
MAPE: [240138666537077.44]
R2: [-0.5928034672565862]
RMSE: [1.5182714266059383]
Training Lasso with 14 days...
Lasso trained!
MAPE: [240138666537077.44, 242945824963699.53]
R2: [-0.5928034672565862, -0.5699560599960185]
RMSE: [1.5182714266059383, 1.488398455868865]
Training Lasso with 21 days...
Lasso trained!
MAPE: [240138666537077.44, 242945824963699.53, 241660683570206.66]
R2: [-0.5928034672565862, -0.5699560599960185, -0.5410064617829858]
RMSE: [1.5182714266059383, 1.488398455868865, 1.4648768286910754]
Training Lasso with 28 days...
Lasso trained!
MAPE: [240138666537077.44, 242945824963699.53, 241660683570206.66, 241287483416404.16]
R2: [-0.5928034672565862, -0.5699560599960185, -0.5410064617829858, -0.5244424490512473]
RMSE: [1.5182714266059383, 1.488398455868865, 1.4648768286910754, 1.4504182615678616]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># File path to save the dictionary</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;../data/model_exo4_results.pkl&#39;</span>

<span class="c1"># Save the dictionary into a file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model_dict</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># Specify the path to the pickle file</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;../data/model_exo4_results.pkl&#39;</span>

<span class="c1"># Open the pickle file in read mode</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="c1"># Load the dictionary from the pickle file</span>
    <span class="n">dictionary</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="c1"># Now you can use the dictionary</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Bayesan Ridge&#39;: {&#39;model&#39;: BayesianRidge(), &#39;grid&#39;: {&#39;model__alpha_1&#39;: [1e-06, 1e-05, 0.0001, 0.001, 0.01, 0.1]}, &#39;MAPE_score&#39;: [73898798301139.05, 68914432611756.83, 67492324032848.99, 67383275300127.99], &#39;R2_score&#39;: [-0.06712612345592733, 0.26625958763597585, 0.09949856424185008, 0.22216342362020222], &#39;RMSE_score&#39;: [1.2550013476282504, 0.7262360716599138, 0.6554768651759865, 0.6075941838352815], &#39;model_ready&#39;: [BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, BayesianRidge())]),
              random_state=42,
              search_spaces={&#39;model__alpha_1&#39;: [1e-06, 1e-05, 0.0001, 0.001,
                                                0.01, 0.1]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, BayesianRidge())]),
              random_state=42,
              search_spaces={&#39;model__alpha_1&#39;: [1e-06, 1e-05, 0.0001, 0.001,
                                                0.01, 0.1]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, BayesianRidge())]),
              random_state=42,
              search_spaces={&#39;model__alpha_1&#39;: [1e-06, 1e-05, 0.0001, 0.001,
                                                0.01, 0.1]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, BayesianRidge())]),
              random_state=42,
              search_spaces={&#39;model__alpha_1&#39;: [1e-06, 1e-05, 0.0001, 0.001,
                                                0.01, 0.1]})]}, &#39;Decision Tree&#39;: {&#39;model&#39;: DecisionTreeRegressor(random_state=42), &#39;grid&#39;: {&#39;model__max_depth&#39;: (1, 20), &#39;model__min_samples_split&#39;: (0.1, 1.0)}, &#39;MAPE_score&#39;: [75993161818493.97, 68944164300369.695, 66622691169241.414, 63014998799113.46], &#39;R2_score&#39;: [0.16318669499555646, 0.20369849193354944, 0.21951697490572006, 0.22474763368950135], &#39;RMSE_score&#39;: [0.7562809728604636, 0.7132162433731707, 0.700200386300988, 0.6952352915986022], &#39;model_ready&#39;: [BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;,
                                         DecisionTreeRegressor(random_state=42))]),
              random_state=42,
              search_spaces={&#39;model__max_depth&#39;: (1, 20),
                             &#39;model__min_samples_split&#39;: (0.1, 1.0)}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;,
                                         DecisionTreeRegressor(random_state=42))]),
              random_state=42,
              search_spaces={&#39;model__max_depth&#39;: (1, 20),
                             &#39;model__min_samples_split&#39;: (0.1, 1.0)}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;,
                                         DecisionTreeRegressor(random_state=42))]),
              random_state=42,
              search_spaces={&#39;model__max_depth&#39;: (1, 20),
                             &#39;model__min_samples_split&#39;: (0.1, 1.0)}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;,
                                         DecisionTreeRegressor(random_state=42))]),
              random_state=42,
              search_spaces={&#39;model__max_depth&#39;: (1, 20),
                             &#39;model__min_samples_split&#39;: (0.1, 1.0)})]}, &#39;Random Forest&#39;: {&#39;model&#39;: RandomForestRegressor(random_state=42), &#39;grid&#39;: {&#39;model__max_depth&#39;: (1, 20), &#39;model__n_estimators&#39;: [100, 200, 300]}, &#39;n_estimators&#39;: range(1, 20), &#39;MAPE_score&#39;: [81465836579909.05, 71959590055394.88, 69558521791646.06, 66827294760542.74], &#39;R2_score&#39;: [0.5406801886556266, 0.5783187534413512, 0.5890122202460786, 0.597841500556488], &#39;RMSE_score&#39;: [0.42454057499538567, 0.389371465164454, 0.37841497904252713, 0.3706740962470798], &#39;model_ready&#39;: [BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;,
                                         RandomForestRegressor(random_state=42))]),
              random_state=42,
              search_spaces={&#39;model__max_depth&#39;: (1, 20),
                             &#39;model__n_estimators&#39;: [100, 200, 300]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;,
                                         RandomForestRegressor(random_state=42))]),
              random_state=42,
              search_spaces={&#39;model__max_depth&#39;: (1, 20),
                             &#39;model__n_estimators&#39;: [100, 200, 300]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;,
                                         RandomForestRegressor(random_state=42))]),
              random_state=42,
              search_spaces={&#39;model__max_depth&#39;: (1, 20),
                             &#39;model__n_estimators&#39;: [100, 200, 300]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;,
                                         RandomForestRegressor(random_state=42))]),
              random_state=42,
              search_spaces={&#39;model__max_depth&#39;: (1, 20),
                             &#39;model__n_estimators&#39;: [100, 200, 300]})]}, &#39;Gradient Boosting&#39;: {&#39;model&#39;: GradientBoostingRegressor(random_state=42), &#39;grid&#39;: {&#39;model__max_depth&#39;: (1, 20), &#39;model__min_samples_split&#39;: (0.1, 1.0)}, &#39;MAPE_score&#39;: [79415001197583.97, 71893518789688.72, 70574813411335.17, 69045558225119.32], &#39;R2_score&#39;: [0.5029183398773868, 0.5595047123074258, 0.5846994229105581, 0.5991204201913948], &#39;RMSE_score&#39;: [0.46016006518043573, 0.4075631481985184, 0.38327417006070996, 0.3698219701238626], &#39;model_ready&#39;: [BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;,
                                         GradientBoostingRegressor(random_state=42))]),
              random_state=42,
              search_spaces={&#39;model__max_depth&#39;: (1, 20),
                             &#39;model__min_samples_split&#39;: (0.1, 1.0)}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;,
                                         GradientBoostingRegressor(random_state=42))]),
              random_state=42,
              search_spaces={&#39;model__max_depth&#39;: (1, 20),
                             &#39;model__min_samples_split&#39;: (0.1, 1.0)}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;,
                                         GradientBoostingRegressor(random_state=42))]),
              random_state=42,
              search_spaces={&#39;model__max_depth&#39;: (1, 20),
                             &#39;model__min_samples_split&#39;: (0.1, 1.0)}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;,
                                         GradientBoostingRegressor(random_state=42))]),
              random_state=42,
              search_spaces={&#39;model__max_depth&#39;: (1, 20),
                             &#39;model__min_samples_split&#39;: (0.1, 1.0)})]}, &#39;Knn&#39;: {&#39;model&#39;: KNeighborsRegressor(), &#39;grid&#39;: {&#39;model__n_neighbors&#39;: (1, 20)}, &#39;MAPE_score&#39;: [118230725086260.19, 108633253360282.53, 104740062639445.05, 101870089615838.69], &#39;R2_score&#39;: [0.16253721240165228, 0.27626620698655907, 0.3327846713942044, 0.36469743719796566], &#39;RMSE_score&#39;: [0.7655407333533388, 0.6583301264890035, 0.6052427104481826, 0.5774211622509806], &#39;model_ready&#39;: [BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, KNeighborsRegressor())]),
              random_state=42, search_spaces={&#39;model__n_neighbors&#39;: (1, 20)}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, KNeighborsRegressor())]),
              random_state=42, search_spaces={&#39;model__n_neighbors&#39;: (1, 20)}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, KNeighborsRegressor())]),
              random_state=42, search_spaces={&#39;model__n_neighbors&#39;: (1, 20)}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, KNeighborsRegressor())]),
              random_state=42, search_spaces={&#39;model__n_neighbors&#39;: (1, 20)})]}, &#39;Ridge&#39;: {&#39;model&#39;: Ridge(), &#39;grid&#39;: {&#39;model__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100, 1000]}, &#39;MAPE_score&#39;: [73164011537919.77, 68381511198469.91, 67065877316615.7, 67043805393289.1], &#39;R2_score&#39;: [-0.16579407672246332, 0.24687739078321985, 0.12943358088385232, 0.22893309961650873], &#39;RMSE_score&#39;: [1.4662393697494618, 0.7869598540809531, 0.648804471255127, 0.6143736697358341], &#39;model_ready&#39;: [BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, Ridge())]),
              random_state=42,
              search_spaces={&#39;model__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100,
                                              1000]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, Ridge())]),
              random_state=42,
              search_spaces={&#39;model__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100,
                                              1000]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, Ridge())]),
              random_state=42,
              search_spaces={&#39;model__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100,
                                              1000]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, Ridge())]),
              random_state=42,
              search_spaces={&#39;model__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100,
                                              1000]})]}, &#39;Lasso&#39;: {&#39;model&#39;: Lasso(), &#39;grid&#39;: {&#39;model__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100, 1000]}, &#39;MAPE_score&#39;: [240138666537077.44, 242945824963699.53, 241660683570206.66, 241287483416404.16], &#39;R2_score&#39;: [-0.5928034672565862, -0.5699560599960185, -0.5410064617829858, -0.5244424490512473], &#39;RMSE_score&#39;: [1.5182714266059383, 1.488398455868865, 1.4648768286910754, 1.4504182615678616], &#39;model_ready&#39;: [BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, Lasso())]),
              random_state=42,
              search_spaces={&#39;model__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100,
                                              1000]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, Lasso())]),
              random_state=42,
              search_spaces={&#39;model__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100,
                                              1000]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, Lasso())]),
              random_state=42,
              search_spaces={&#39;model__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100,
                                              1000]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, Lasso())]),
              random_state=42,
              search_spaces={&#39;model__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100,
                                              1000]})]}}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_dict</span> <span class="o">=</span> <span class="n">dictionary</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_df_scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">model_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">list_r2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">list_mape</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">list_rmse</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">min_rmse</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">number_of_days</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">model_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">list_r2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;R2_score&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">list_mape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;MAPE_score&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">list_rmse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;RMSE_score&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;RMSE_score&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_rmse</span><span class="p">):</span>
            <span class="n">num_days</span> <span class="o">=</span> <span class="n">number_of_days</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">min_rmse</span> <span class="o">=</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;RMSE_score&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">best_model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="n">df_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Model&#39;</span><span class="p">:</span> <span class="n">model_names</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">list_r2</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">list_mape</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">list_rmse</span><span class="p">})</span>
    <span class="n">list_mape</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">list_r2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">list_rmse</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">list_df_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">number_of_days</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of days: </span><span class="si">{</span><span class="n">number_of_days</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">list_df_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of days: 7
            Model        R2         MAPE     RMSE
    Bayesan Ridge -0.067126 7.389880e+13 1.255001
    Decision Tree  0.163187 7.599316e+13 0.756281
    Random Forest  0.540680 8.146584e+13 0.424541
Gradient Boosting  0.502918 7.941500e+13 0.460160
              Knn  0.162537 1.182307e+14 0.765541
            Ridge -0.165794 7.316401e+13 1.466239
            Lasso -0.592803 2.401387e+14 1.518271
Number of days: 14
            Model        R2         MAPE     RMSE
    Bayesan Ridge  0.266260 6.891443e+13 0.726236
    Decision Tree  0.203698 6.894416e+13 0.713216
    Random Forest  0.578319 7.195959e+13 0.389371
Gradient Boosting  0.559505 7.189352e+13 0.407563
              Knn  0.276266 1.086333e+14 0.658330
            Ridge  0.246877 6.838151e+13 0.786960
            Lasso -0.569956 2.429458e+14 1.488398
Number of days: 21
            Model        R2         MAPE     RMSE
    Bayesan Ridge  0.099499 6.749232e+13 0.655477
    Decision Tree  0.219517 6.662269e+13 0.700200
    Random Forest  0.589012 6.955852e+13 0.378415
Gradient Boosting  0.584699 7.057481e+13 0.383274
              Knn  0.332785 1.047401e+14 0.605243
            Ridge  0.129434 6.706588e+13 0.648804
            Lasso -0.541006 2.416607e+14 1.464877
Number of days: 28
            Model        R2         MAPE     RMSE
    Bayesan Ridge  0.222163 6.738328e+13 0.607594
    Decision Tree  0.224748 6.301500e+13 0.695235
    Random Forest  0.597842 6.682729e+13 0.370674
Gradient Boosting  0.599120 6.904556e+13 0.369822
              Knn  0.364697 1.018701e+14 0.577421
            Ridge  0.228933 6.704381e+13 0.614374
            Lasso -0.524442 2.412875e+14 1.450418
</pre></div>
</div>
</div>
</div>
<p>Let’s analize the RMSE results to find the best model and the best training set:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_df_scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">list_rmse</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">number_of_days</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  
        <span class="n">list_rmse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;RMSE_score&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;RMSE_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number_of_days</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">df_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Model&#39;</span><span class="p">:</span> <span class="n">model_names</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">list_rmse</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">name</span><span class="p">:</span> <span class="n">list_rmse</span><span class="p">})</span>
    <span class="n">list_df_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_scores</span><span class="p">)</span>
    <span class="n">list_rmse</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_df_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_scores</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model</th>
      <th>RMSE_7</th>
      <th>RMSE_14</th>
      <th>RMSE_21</th>
      <th>RMSE_28</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Bayesan Ridge</td>
      <td>1.255001</td>
      <td>0.726236</td>
      <td>0.655477</td>
      <td>0.607594</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Decision Tree</td>
      <td>0.756281</td>
      <td>0.713216</td>
      <td>0.700200</td>
      <td>0.695235</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Random Forest</td>
      <td>0.424541</td>
      <td>0.389371</td>
      <td>0.378415</td>
      <td>0.370674</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Gradient Boosting</td>
      <td>0.460160</td>
      <td>0.407563</td>
      <td>0.383274</td>
      <td>0.369822</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Knn</td>
      <td>0.765541</td>
      <td>0.658330</td>
      <td>0.605243</td>
      <td>0.577421</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Ridge</td>
      <td>1.466239</td>
      <td>0.786960</td>
      <td>0.648804</td>
      <td>0.614374</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lasso</td>
      <td>1.518271</td>
      <td>1.488398</td>
      <td>1.464877</td>
      <td>1.450418</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The best model is </span><span class="si">{</span><span class="n">best_model</span><span class="si">}</span><span class="s1"> with a RMSE of </span><span class="si">{</span><span class="n">min_rmse</span><span class="si">}</span><span class="s1">, and </span><span class="si">{</span><span class="n">num_days</span><span class="si">}</span><span class="s1"> days of training&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The best model is Gradient Boosting with a RMSE of 0.3698219701238626, and 28 days of training
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot the best model results</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">results_dict</span><span class="p">[</span><span class="n">best_model</span><span class="p">][</span><span class="n">num_days</span><span class="p">][</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">results_dict</span><span class="p">[</span><span class="n">best_model</span><span class="p">][</span><span class="n">num_days</span><span class="p">][</span><span class="s1">&#39;y_test&#39;</span><span class="p">]</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best model: </span><span class="si">{</span><span class="n">best_model</span><span class="si">}</span><span class="s1"> with </span><span class="si">{</span><span class="n">num_days</span><span class="si">}</span><span class="s1"> days of training&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bcee12ed3126da3c9eabc2e788a7ab8f8bc38bbae419fdcc7ce3fa6d893bff84.png" src="_images/bcee12ed3126da3c9eabc2e788a7ab8f8bc38bbae419fdcc7ce3fa6d893bff84.png" />
</div>
</div>
<p>A example of the graph prediction-true of the best model with the best training set, as we can see the graph is not perfect, but it does follow the tendency pretty well</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="exo3.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Ejercicio 3</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-dataset-already-processed">Loading Dataset, already processed</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-models-and-their-parameters">Defining models and their parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tuning-models-and-training-them">Tuning models and training them</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>