
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Ejercicio 4 &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js?v=afe5de03"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'exo4';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Load data" href="exo3.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Parcial practico 2
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fexo4.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/exo4.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Ejercicio 4</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-dataset-already-processed">Loading Dataset, already processed</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-models-and-their-parameters">Defining models and their parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tuning-models-and-training-them">Tuning models and training them</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="ejercicio-4">
<h1>Ejercicio 4<a class="headerlink" href="#ejercicio-4" title="Link to this heading">#</a></h1>
<section id="loading-dataset-already-processed">
<h2>Loading Dataset, already processed<a class="headerlink" href="#loading-dataset-already-processed" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfWind</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/data_wind_imputed.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfWind</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Hora</th>
      <th>Dirección del viento horaria (gr)</th>
      <th>Velocidad horario del viento (m/s)</th>
      <th>Máxima ráfaga de viento (m/s)</th>
      <th>Fecha</th>
      <th>Humedad rel. máx. hora anterior (AUT)</th>
      <th>Humedad rel. mín. hora anterior (AUT)</th>
      <th>Temperatura máx. hora anterior (AUT) (K)</th>
      <th>Temperatura mín. hora anterior (AUT) (K)</th>
      <th>Humedad relativa horaria</th>
      <th>Presión atmosférica a nivel de estación, horaria (Pa)</th>
      <th>Precipitación total por hora (m)</th>
      <th>Presión atmosférica máx. hora anterior (AUT) (Pa)</th>
      <th>Presión atmosférica mín. hora anterior (AUT) (Pa)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12</td>
      <td>0.809017</td>
      <td>1.8</td>
      <td>3.8</td>
      <td>2000-01-01 12:00:00</td>
      <td>0.69</td>
      <td>0.60</td>
      <td>295.75</td>
      <td>293.85</td>
      <td>0.61</td>
      <td>88820.0</td>
      <td>0.0</td>
      <td>88820.0</td>
      <td>88770.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>13</td>
      <td>0.965926</td>
      <td>2.7</td>
      <td>4.7</td>
      <td>2000-01-01 13:00:00</td>
      <td>0.62</td>
      <td>0.55</td>
      <td>297.35</td>
      <td>295.65</td>
      <td>0.55</td>
      <td>88840.0</td>
      <td>0.0</td>
      <td>88840.0</td>
      <td>88820.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>14</td>
      <td>0.891007</td>
      <td>2.0</td>
      <td>4.9</td>
      <td>2000-01-01 14:00:00</td>
      <td>0.56</td>
      <td>0.50</td>
      <td>298.65</td>
      <td>297.45</td>
      <td>0.51</td>
      <td>88810.0</td>
      <td>0.0</td>
      <td>88840.0</td>
      <td>88810.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>15</td>
      <td>0.848048</td>
      <td>2.5</td>
      <td>5.8</td>
      <td>2000-01-01 15:00:00</td>
      <td>0.52</td>
      <td>0.44</td>
      <td>300.55</td>
      <td>298.15</td>
      <td>0.44</td>
      <td>88740.0</td>
      <td>0.0</td>
      <td>88810.0</td>
      <td>88740.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>16</td>
      <td>0.224951</td>
      <td>2.4</td>
      <td>5.8</td>
      <td>2000-01-01 16:00:00</td>
      <td>0.50</td>
      <td>0.43</td>
      <td>300.25</td>
      <td>298.65</td>
      <td>0.46</td>
      <td>88650.0</td>
      <td>0.0</td>
      <td>88740.0</td>
      <td>88650.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfWind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>90276
</pre></div>
</div>
</div>
</div>
</section>
<section id="defining-models-and-their-parameters">
<h2>Defining models and their parameters<a class="headerlink" href="#defining-models-and-their-parameters" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span><span class="p">,</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>

<span class="n">grid_nb</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">model_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">model_dict</span><span class="p">[</span><span class="s1">&#39;Bayesan Ridge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">BayesianRidge</span><span class="p">(),</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model__alpha_1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">]},</span> <span class="s1">&#39;MAPE_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;R2_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;RMSE_score&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">model_dict</span><span class="p">[</span><span class="s1">&#39;Decision Tree&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model__max_depth&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span><span class="s1">&#39;model__min_samples_split&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)},</span> <span class="s1">&#39;MAPE_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;R2_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;RMSE_score&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">model_dict</span><span class="p">[</span><span class="s1">&#39;Random Forest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model__max_depth&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span><span class="s1">&#39;model__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]},</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="s1">&#39;MAPE_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;R2_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;RMSE_score&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">model_dict</span><span class="p">[</span><span class="s1">&#39;Gradient Boosting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model__max_depth&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> <span class="p">,</span><span class="s1">&#39;model__min_samples_split&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)},</span> <span class="s1">&#39;MAPE_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;R2_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;RMSE_score&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">model_dict</span><span class="p">[</span><span class="s1">&#39;Knn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">KNeighborsRegressor</span><span class="p">(),</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model__n_neighbors&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)},</span> <span class="s1">&#39;MAPE_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;R2_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;RMSE_score&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">model_dict</span><span class="p">[</span><span class="s1">&#39;Ridge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">Ridge</span><span class="p">(),</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">]},</span> <span class="s1">&#39;MAPE_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;R2_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;RMSE_score&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">model_dict</span><span class="p">[</span><span class="s1">&#39;Lasso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">Lasso</span><span class="p">(),</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;model__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">]},</span> <span class="s1">&#39;MAPE_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;R2_score&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;RMSE_score&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model_info</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;MAPE_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;R2_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">model_info</span><span class="p">[</span><span class="s1">&#39;RMSE_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">number_of_days</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span>

<span class="n">model_dict</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Bayesan Ridge&#39;: {&#39;model&#39;: BayesianRidge(),
  &#39;grid&#39;: {&#39;model__alpha_1&#39;: [1e-06, 1e-05, 0.0001, 0.001, 0.01, 0.1]},
  &#39;MAPE_score&#39;: [],
  &#39;R2_score&#39;: [],
  &#39;RMSE_score&#39;: []},
 &#39;Decision Tree&#39;: {&#39;model&#39;: DecisionTreeRegressor(random_state=42),
  &#39;grid&#39;: {&#39;model__max_depth&#39;: (1, 20),
   &#39;model__min_samples_split&#39;: (0.1, 1.0)},
  &#39;MAPE_score&#39;: [],
  &#39;R2_score&#39;: [],
  &#39;RMSE_score&#39;: []},
 &#39;Random Forest&#39;: {&#39;model&#39;: RandomForestRegressor(random_state=42),
  &#39;grid&#39;: {&#39;model__max_depth&#39;: (1, 20),
   &#39;model__n_estimators&#39;: [100, 200, 300]},
  &#39;n_estimators&#39;: range(1, 20),
  &#39;MAPE_score&#39;: [],
  &#39;R2_score&#39;: [],
  &#39;RMSE_score&#39;: []},
 &#39;Gradient Boosting&#39;: {&#39;model&#39;: GradientBoostingRegressor(random_state=42),
  &#39;grid&#39;: {&#39;model__max_depth&#39;: (1, 20),
   &#39;model__min_samples_split&#39;: (0.1, 1.0)},
  &#39;MAPE_score&#39;: [],
  &#39;R2_score&#39;: [],
  &#39;RMSE_score&#39;: []},
 &#39;Knn&#39;: {&#39;model&#39;: KNeighborsRegressor(),
  &#39;grid&#39;: {&#39;model__n_neighbors&#39;: (1, 20)},
  &#39;MAPE_score&#39;: [],
  &#39;R2_score&#39;: [],
  &#39;RMSE_score&#39;: []},
 &#39;Ridge&#39;: {&#39;model&#39;: Ridge(),
  &#39;grid&#39;: {&#39;model__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100, 1000]},
  &#39;MAPE_score&#39;: [],
  &#39;R2_score&#39;: [],
  &#39;RMSE_score&#39;: []},
 &#39;Lasso&#39;: {&#39;model&#39;: Lasso(),
  &#39;grid&#39;: {&#39;model__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100, 1000]},
  &#39;MAPE_score&#39;: [],
  &#39;R2_score&#39;: [],
  &#39;RMSE_score&#39;: []}}
</pre></div>
</div>
</div>
</div>
<p>I instantiated a dictionary of models containg their parameters and their future scores so that it will be easier to manage them later on</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model_info</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">days</span> <span class="ow">in</span> <span class="n">number_of_days</span><span class="p">:</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="n">days</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;y_pred&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;y_test&#39;</span><span class="p">:</span> <span class="p">[]}</span>
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">number_of_days</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[7, 14, 21, 28]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfWind</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Hora</th>
      <th>Dirección del viento horaria (gr)</th>
      <th>Velocidad horario del viento (m/s)</th>
      <th>Máxima ráfaga de viento (m/s)</th>
      <th>Fecha</th>
      <th>Humedad rel. máx. hora anterior (AUT)</th>
      <th>Humedad rel. mín. hora anterior (AUT)</th>
      <th>Temperatura máx. hora anterior (AUT) (K)</th>
      <th>Temperatura mín. hora anterior (AUT) (K)</th>
      <th>Humedad relativa horaria</th>
      <th>Presión atmosférica a nivel de estación, horaria (Pa)</th>
      <th>Precipitación total por hora (m)</th>
      <th>Presión atmosférica máx. hora anterior (AUT) (Pa)</th>
      <th>Presión atmosférica mín. hora anterior (AUT) (Pa)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12</td>
      <td>0.809017</td>
      <td>1.8</td>
      <td>3.8</td>
      <td>2000-01-01 12:00:00</td>
      <td>0.69</td>
      <td>0.60</td>
      <td>295.75</td>
      <td>293.85</td>
      <td>0.61</td>
      <td>88820.0</td>
      <td>0.0</td>
      <td>88820.0</td>
      <td>88770.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>13</td>
      <td>0.965926</td>
      <td>2.7</td>
      <td>4.7</td>
      <td>2000-01-01 13:00:00</td>
      <td>0.62</td>
      <td>0.55</td>
      <td>297.35</td>
      <td>295.65</td>
      <td>0.55</td>
      <td>88840.0</td>
      <td>0.0</td>
      <td>88840.0</td>
      <td>88820.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>14</td>
      <td>0.891007</td>
      <td>2.0</td>
      <td>4.9</td>
      <td>2000-01-01 14:00:00</td>
      <td>0.56</td>
      <td>0.50</td>
      <td>298.65</td>
      <td>297.45</td>
      <td>0.51</td>
      <td>88810.0</td>
      <td>0.0</td>
      <td>88840.0</td>
      <td>88810.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>15</td>
      <td>0.848048</td>
      <td>2.5</td>
      <td>5.8</td>
      <td>2000-01-01 15:00:00</td>
      <td>0.52</td>
      <td>0.44</td>
      <td>300.55</td>
      <td>298.15</td>
      <td>0.44</td>
      <td>88740.0</td>
      <td>0.0</td>
      <td>88810.0</td>
      <td>88740.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>16</td>
      <td>0.224951</td>
      <td>2.4</td>
      <td>5.8</td>
      <td>2000-01-01 16:00:00</td>
      <td>0.50</td>
      <td>0.43</td>
      <td>300.25</td>
      <td>298.65</td>
      <td>0.46</td>
      <td>88650.0</td>
      <td>0.0</td>
      <td>88740.0</td>
      <td>88650.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="tuning-models-and-training-them">
<h2>Tuning models and training them<a class="headerlink" href="#tuning-models-and-training-them" title="Link to this heading">#</a></h2>
<p>Using BayesSearchCV i tune the models by searching for the best paramaters with bayesan optimization, this chunk of code takes every model out of the dictionary and finds the best hyperparameters for every possible scenario (in this case the number of days), so that we get the best parameters for every possible way of validation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.discriminant_analysis</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">skopt</span> <span class="kn">import</span> <span class="n">BayesSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="c1"># Create an empty dictionary to store the best parameters for each model</span>
<span class="n">best_params</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">best_params</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;model_ready&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># Iterate over the models and perform parameter search</span>
<span class="k">for</span> <span class="n">numDays</span> <span class="ow">in</span> <span class="n">number_of_days</span><span class="p">:</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">dfWind</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">numDays</span><span class="o">*</span><span class="mi">24</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Velocidad horario del viento (m/s)&#39;</span><span class="p">,</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">dfWind</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">numDays</span><span class="o">*</span><span class="mi">24</span><span class="p">][</span><span class="s1">&#39;Velocidad horario del viento (m/s)&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">]))])</span>
        <span class="c1"># Get the parameter search space for the current model</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;grid&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># Create the BayesSearchCV object for the current model</span>
        <span class="n">search_cv</span> <span class="o">=</span> <span class="n">BayesSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        
        <span class="c1"># Fit the BayesSearchCV object to find the best parameters</span>
        <span class="n">search_cv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        
        <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;model_ready&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">search_cv</span><span class="p">)</span>
        <span class="c1"># Store the best parameters for the current model</span>
        <span class="n">best_params</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">search_cv</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best parameters for </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2"> and with </span><span class="si">{</span><span class="n">numDays</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">search_cv</span><span class="o">.</span><span class="n">best_params_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">line</span> <span class="mi">25</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="n">search_cv</span> <span class="o">=</span> <span class="n">BayesSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="c1"># Fit the BayesSearchCV object to find the best parameters</span>
<span class="ne">---&gt; </span><span class="mi">25</span> <span class="n">search_cv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;model_ready&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">search_cv</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="c1"># Store the best parameters for the current model</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/skopt/searchcv.py:538,</span> in <span class="ni">BayesSearchCV.fit</span><span class="nt">(self, X, y, groups, callback, **fit_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">531</span> <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">532</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">533</span>         <span class="s2">&quot;BayesSearchCV doesn&#39;t support a callable refit, &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">534</span>         <span class="s2">&quot;as it doesn&#39;t define an implicit score to &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">535</span>         <span class="s2">&quot;optimize&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">536</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">538</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">540</span> <span class="c1"># BaseSearchCV never ranked train scores,</span>
<span class="g g-Whitespace">    </span><span class="mi">541</span> <span class="c1"># but apparently we used to ship this (back-compat)</span>
<span class="g g-Whitespace">    </span><span class="mi">542</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_train_score</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/sklearn/base.py:1351,</span> in <span class="ni">_fit_context.&lt;locals&gt;.decorator.&lt;locals&gt;.wrapper</span><span class="nt">(estimator, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1344</span>     <span class="n">estimator</span><span class="o">.</span><span class="n">_validate_params</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1346</span> <span class="k">with</span> <span class="n">config_context</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1347</span>     <span class="n">skip_parameter_validation</span><span class="o">=</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1348</span>         <span class="n">prefer_skip_nested_validation</span> <span class="ow">or</span> <span class="n">global_skip_validation</span>
<span class="g g-Whitespace">   </span><span class="mi">1349</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1350</span> <span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1351</span>     <span class="k">return</span> <span class="n">fit_method</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/sklearn/model_selection/_search.py:970,</span> in <span class="ni">BaseSearchCV.fit</span><span class="nt">(self, X, y, **params)</span>
<span class="g g-Whitespace">    </span><span class="mi">964</span>     <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_results</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">965</span>         <span class="n">all_candidate_params</span><span class="p">,</span> <span class="n">n_splits</span><span class="p">,</span> <span class="n">all_out</span><span class="p">,</span> <span class="n">all_more_results</span>
<span class="g g-Whitespace">    </span><span class="mi">966</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">968</span>     <span class="k">return</span> <span class="n">results</span>
<span class="ne">--&gt; </span><span class="mi">970</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_search</span><span class="p">(</span><span class="n">evaluate_candidates</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">972</span> <span class="c1"># multimetric is determined here because in the case of a callable</span>
<span class="g g-Whitespace">    </span><span class="mi">973</span> <span class="c1"># self.scoring the return type is only known after calling</span>
<span class="g g-Whitespace">    </span><span class="mi">974</span> <span class="n">first_test_score</span> <span class="o">=</span> <span class="n">all_out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;test_scores&quot;</span><span class="p">]</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/skopt/searchcv.py:595,</span> in <span class="ni">BayesSearchCV._run_search</span><span class="nt">(self, evaluate_candidates)</span>
<span class="g g-Whitespace">    </span><span class="mi">591</span> <span class="k">while</span> <span class="n">n_iter</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">592</span>     <span class="c1"># when n_iter &lt; n_points points left for evaluation</span>
<span class="g g-Whitespace">    </span><span class="mi">593</span>     <span class="n">n_points_adjusted</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n_iter</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">595</span>     <span class="n">optim_result</span><span class="p">,</span> <span class="n">score_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">596</span>         <span class="n">search_space</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">597</span>         <span class="n">optimizer</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">598</span>         <span class="n">score_name</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">599</span>         <span class="n">evaluate_candidates</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">600</span>         <span class="n">n_points</span><span class="o">=</span><span class="n">n_points_adjusted</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">601</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">602</span>     <span class="n">n_iter</span> <span class="o">-=</span> <span class="n">n_points</span>
<span class="g g-Whitespace">    </span><span class="mi">604</span>     <span class="k">if</span> <span class="n">eval_callbacks</span><span class="p">(</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">optim_result</span><span class="p">):</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/skopt/searchcv.py:441,</span> in <span class="ni">BayesSearchCV._step</span><span class="nt">(self, search_space, optimizer, score_name, evaluate_candidates, n_points)</span>
<span class="g g-Whitespace">    </span><span class="mi">439</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Generate n_jobs parameters and evaluate them in parallel.&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">440</span> <span class="c1"># get parameter values to evaluate</span>
<span class="ne">--&gt; </span><span class="mi">441</span> <span class="n">params</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="n">n_points</span><span class="o">=</span><span class="n">n_points</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">443</span> <span class="c1"># convert parameters to python native types</span>
<span class="g g-Whitespace">    </span><span class="mi">444</span> <span class="n">params</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/skopt/optimizer/optimizer.py:464,</span> in <span class="ni">Optimizer.ask</span><span class="nt">(self, n_points, strategy)</span>
<span class="g g-Whitespace">    </span><span class="mi">462</span>         <span class="n">opt</span><span class="o">.</span><span class="n">_tell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">y_lie</span><span class="p">,</span> <span class="n">t_lie</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">463</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">464</span>         <span class="n">opt</span><span class="o">.</span><span class="n">_tell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_lie</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">466</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_</span> <span class="o">=</span> <span class="p">{(</span><span class="n">n_points</span><span class="p">,</span> <span class="n">strategy</span><span class="p">):</span> <span class="n">X</span><span class="p">}</span>  <span class="c1"># cache_ the result</span>
<span class="g g-Whitespace">    </span><span class="mi">468</span> <span class="k">return</span> <span class="n">X</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/skopt/optimizer/optimizer.py:615,</span> in <span class="ni">Optimizer._tell</span><span class="nt">(self, x, y, fit)</span>
<span class="g g-Whitespace">    </span><span class="mi">613</span> <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
<span class="g g-Whitespace">    </span><span class="mi">614</span>     <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">615</span>     <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Xi</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">yi</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">617</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;next_xs_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">acq_func</span> <span class="o">==</span> <span class="s2">&quot;gp_hedge&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">618</span>     <span class="bp">self</span><span class="o">.</span><span class="n">gains_</span> <span class="o">-=</span> <span class="n">est</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_xs_</span><span class="p">))</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/skopt/learning/gaussian_process/gpr.py:203,</span> in <span class="ni">GaussianProcessRegressor.fit</span><span class="nt">(self, X, y)</span>
<span class="g g-Whitespace">    </span><span class="mi">199</span>     <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">200</span>         <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">+</span> <span class="n">WhiteKernel</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">201</span>             <span class="n">noise_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="p">,</span> <span class="n">noise_level_bounds</span><span class="o">=</span><span class="s2">&quot;fixed&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">202</span>         <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">203</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">205</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">207</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">208</span>     <span class="c1"># The noise component of this kernel should be set to zero</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span>     <span class="c1"># while estimating K(X_test, X_test)</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">214</span>     <span class="c1"># http://www.gaussianprocess.org/gpml/chapters/RW2.pdf</span>
<span class="g g-Whitespace">    </span><span class="mi">215</span>     <span class="c1"># Hence this hack</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/sklearn/base.py:1351,</span> in <span class="ni">_fit_context.&lt;locals&gt;.decorator.&lt;locals&gt;.wrapper</span><span class="nt">(estimator, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1344</span>     <span class="n">estimator</span><span class="o">.</span><span class="n">_validate_params</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1346</span> <span class="k">with</span> <span class="n">config_context</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1347</span>     <span class="n">skip_parameter_validation</span><span class="o">=</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1348</span>         <span class="n">prefer_skip_nested_validation</span> <span class="ow">or</span> <span class="n">global_skip_validation</span>
<span class="g g-Whitespace">   </span><span class="mi">1349</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1350</span> <span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1351</span>     <span class="k">return</span> <span class="n">fit_method</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/sklearn/gaussian_process/_gpr.py:307,</span> in <span class="ni">GaussianProcessRegressor.fit</span><span class="nt">(self, X, y)</span>
<span class="g g-Whitespace">    </span><span class="mi">302</span>         <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">log_marginal_likelihood</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">clone_kernel</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span> <span class="c1"># First optimize starting from theta specified in kernel</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span> <span class="n">optima</span> <span class="o">=</span> <span class="p">[</span>
<span class="g g-Whitespace">    </span><span class="mi">306</span>     <span class="p">(</span>
<span class="ne">--&gt; </span><span class="mi">307</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_constrained_optimization</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">308</span>             <span class="n">obj_func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel_</span><span class="o">.</span><span class="n">bounds</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">311</span> <span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">313</span> <span class="c1"># Additional runs are performed from log-uniform chosen initial</span>
<span class="g g-Whitespace">    </span><span class="mi">314</span> <span class="c1"># theta</span>
<span class="g g-Whitespace">    </span><span class="mi">315</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_restarts_optimizer</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/sklearn/gaussian_process/_gpr.py:656,</span> in <span class="ni">GaussianProcessRegressor._constrained_optimization</span><span class="nt">(self, obj_func, initial_theta, bounds)</span>
<span class="g g-Whitespace">    </span><span class="mi">654</span> <span class="k">def</span> <span class="nf">_constrained_optimization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_func</span><span class="p">,</span> <span class="n">initial_theta</span><span class="p">,</span> <span class="n">bounds</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">655</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">==</span> <span class="s2">&quot;fmin_l_bfgs_b&quot;</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">656</span>         <span class="n">opt_res</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">657</span>             <span class="n">obj_func</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">658</span>             <span class="n">initial_theta</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">659</span>             <span class="n">method</span><span class="o">=</span><span class="s2">&quot;L-BFGS-B&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">660</span>             <span class="n">jac</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">661</span>             <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">662</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">663</span>         <span class="n">_check_optimize_result</span><span class="p">(</span><span class="s2">&quot;lbfgs&quot;</span><span class="p">,</span> <span class="n">opt_res</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">664</span>         <span class="n">theta_opt</span><span class="p">,</span> <span class="n">func_min</span> <span class="o">=</span> <span class="n">opt_res</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">opt_res</span><span class="o">.</span><span class="n">fun</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/scipy/optimize/_minimize.py:623,</span> in <span class="ni">minimize</span><span class="nt">(fun, x0, args, method, jac, hess, hessp, bounds, constraints, tol, callback, options)</span>
<span class="g g-Whitespace">    </span><span class="mi">620</span>     <span class="k">return</span> <span class="n">_minimize_newtoncg</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">jac</span><span class="p">,</span> <span class="n">hess</span><span class="p">,</span> <span class="n">hessp</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">621</span>                               <span class="o">**</span><span class="n">options</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">622</span> <span class="k">elif</span> <span class="n">meth</span> <span class="o">==</span> <span class="s1">&#39;l-bfgs-b&#39;</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">623</span>     <span class="k">return</span> <span class="n">_minimize_lbfgsb</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">jac</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">624</span>                             <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">625</span> <span class="k">elif</span> <span class="n">meth</span> <span class="o">==</span> <span class="s1">&#39;tnc&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">626</span>     <span class="k">return</span> <span class="n">_minimize_tnc</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">jac</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">627</span>                          <span class="o">**</span><span class="n">options</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/scipy/optimize/lbfgsb.py:360,</span> in <span class="ni">_minimize_lbfgsb</span><span class="nt">(fun, x0, args, jac, bounds, disp, maxcor, ftol, gtol, eps, maxfun, maxiter, iprint, callback, maxls, finite_diff_rel_step, **unknown_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">354</span> <span class="n">task_str</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">355</span> <span class="k">if</span> <span class="n">task_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;FG&#39;</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">356</span>     <span class="c1"># The minimization routine wants f and g at the current x.</span>
<span class="g g-Whitespace">    </span><span class="mi">357</span>     <span class="c1"># Note that interruptions due to maxfun are postponed</span>
<span class="g g-Whitespace">    </span><span class="mi">358</span>     <span class="c1"># until the completion of the current minimization iteration.</span>
<span class="g g-Whitespace">    </span><span class="mi">359</span>     <span class="c1"># Overwrite f and g:</span>
<span class="ne">--&gt; </span><span class="mi">360</span>     <span class="n">f</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">func_and_grad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">361</span> <span class="k">elif</span> <span class="n">task_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;NEW_X&#39;</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">362</span>     <span class="c1"># new iteration</span>
<span class="g g-Whitespace">    </span><span class="mi">363</span>     <span class="n">n_iterations</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/scipy/optimize/_differentiable_functions.py:267,</span> in <span class="ni">ScalarFunction.fun_and_grad</span><span class="nt">(self, x)</span>
<span class="g g-Whitespace">    </span><span class="mi">265</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">266</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_update_x_impl</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">267</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_fun</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">268</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_grad</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">269</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/scipy/optimize/_differentiable_functions.py:233,</span> in <span class="ni">ScalarFunction._update_fun</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">231</span> <span class="k">def</span> <span class="nf">_update_fun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">232</span>     <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_updated</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">233</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_update_fun_impl</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">234</span>         <span class="bp">self</span><span class="o">.</span><span class="n">f_updated</span> <span class="o">=</span> <span class="kc">True</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/scipy/optimize/_differentiable_functions.py:137,</span> in <span class="ni">ScalarFunction.__init__.&lt;locals&gt;.update_fun</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">136</span> <span class="k">def</span> <span class="nf">update_fun</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">137</span>     <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">fun_wrapped</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/scipy/optimize/_differentiable_functions.py:134,</span> in <span class="ni">ScalarFunction.__init__.&lt;locals&gt;.fun_wrapped</span><span class="nt">(x)</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfev</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="g g-Whitespace">    </span><span class="mi">131</span> <span class="c1"># Send a copy because the user may overwrite it.</span>
<span class="g g-Whitespace">    </span><span class="mi">132</span> <span class="c1"># Overwriting results in undefined behaviour because</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span> <span class="c1"># fun(self.x) will change self.x, with the two no longer linked.</span>
<span class="ne">--&gt; </span><span class="mi">134</span> <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/scipy/optimize/optimize.py:74,</span> in <span class="ni">MemoizeJac.__call__</span><span class="nt">(self, x, *args)</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span><span class="w">     </span><span class="sd">&quot;&quot;&quot; returns the the function value &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">74</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_compute_if_needed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">75</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/scipy/optimize/optimize.py:68,</span> in <span class="ni">MemoizeJac._compute_if_needed</span><span class="nt">(self, x, *args)</span>
<span class="g g-Whitespace">     </span><span class="mi">66</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">jac</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>     <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">68</span>     <span class="n">fg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fun</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span>     <span class="bp">self</span><span class="o">.</span><span class="n">jac</span> <span class="o">=</span> <span class="n">fg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">fg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/sklearn/gaussian_process/_gpr.py:297,</span> in <span class="ni">GaussianProcessRegressor.fit.&lt;locals&gt;.obj_func</span><span class="nt">(theta, eval_gradient)</span>
<span class="g g-Whitespace">    </span><span class="mi">295</span> <span class="k">def</span> <span class="nf">obj_func</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">eval_gradient</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">296</span>     <span class="k">if</span> <span class="n">eval_gradient</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">297</span>         <span class="n">lml</span><span class="p">,</span> <span class="n">grad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_marginal_likelihood</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">298</span>             <span class="n">theta</span><span class="p">,</span> <span class="n">eval_gradient</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clone_kernel</span><span class="o">=</span><span class="kc">False</span>
<span class="g g-Whitespace">    </span><span class="mi">299</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">300</span>         <span class="k">return</span> <span class="o">-</span><span class="n">lml</span><span class="p">,</span> <span class="o">-</span><span class="n">grad</span>
<span class="g g-Whitespace">    </span><span class="mi">301</span>     <span class="k">else</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/sklearn/gaussian_process/_gpr.py:580,</span> in <span class="ni">GaussianProcessRegressor.log_marginal_likelihood</span><span class="nt">(self, theta, eval_gradient, clone_kernel)</span>
<span class="g g-Whitespace">    </span><span class="mi">577</span>     <span class="n">kernel</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
<span class="g g-Whitespace">    </span><span class="mi">579</span> <span class="k">if</span> <span class="n">eval_gradient</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">580</span>     <span class="n">K</span><span class="p">,</span> <span class="n">K_gradient</span> <span class="o">=</span> <span class="n">kernel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_train_</span><span class="p">,</span> <span class="n">eval_gradient</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">581</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">582</span>     <span class="n">K</span> <span class="o">=</span> <span class="n">kernel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_train_</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/sklearn/gaussian_process/kernels.py:846,</span> in <span class="ni">Sum.__call__</span><span class="nt">(self, X, Y, eval_gradient)</span>
<span class="g g-Whitespace">    </span><span class="mi">818</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Return the kernel k(X, Y) and optionally its gradient.</span>
<span class="g g-Whitespace">    </span><span class="mi">819</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">820</span><span class="sd"> Parameters</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">843</span><span class="sd">     is True.</span>
<span class="g g-Whitespace">    </span><span class="mi">844</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">845</span> <span class="k">if</span> <span class="n">eval_gradient</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">846</span>     <span class="n">K1</span><span class="p">,</span> <span class="n">K1_gradient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">eval_gradient</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">847</span>     <span class="n">K2</span><span class="p">,</span> <span class="n">K2_gradient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">eval_gradient</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">848</span>     <span class="k">return</span> <span class="n">K1</span> <span class="o">+</span> <span class="n">K2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">K1_gradient</span><span class="p">,</span> <span class="n">K2_gradient</span><span class="p">))</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/sklearn/gaussian_process/kernels.py:945,</span> in <span class="ni">Product.__call__</span><span class="nt">(self, X, Y, eval_gradient)</span>
<span class="g g-Whitespace">    </span><span class="mi">943</span> <span class="k">if</span> <span class="n">eval_gradient</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">944</span>     <span class="n">K1</span><span class="p">,</span> <span class="n">K1_gradient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">eval_gradient</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">945</span>     <span class="n">K2</span><span class="p">,</span> <span class="n">K2_gradient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">eval_gradient</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">946</span>     <span class="k">return</span> <span class="n">K1</span> <span class="o">*</span> <span class="n">K2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">947</span>         <span class="p">(</span><span class="n">K1_gradient</span> <span class="o">*</span> <span class="n">K2</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">K2_gradient</span> <span class="o">*</span> <span class="n">K1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">948</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">949</span> <span class="k">else</span><span class="p">:</span>

<span class="nn">File ~/miniconda3/envs/ml_venv/lib/python3.9/site-packages/skopt/learning/gaussian_process/kernels.py:401,</span> in <span class="ni">HammingKernel.__call__</span><span class="nt">(self, X, Y, eval_gradient)</span>
<span class="g g-Whitespace">    </span><span class="mi">398</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">399</span>     <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">401</span> <span class="n">indicator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Y</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span> <span class="n">kernel_prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">length_scale</span> <span class="o">*</span> <span class="n">indicator</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">404</span> <span class="c1"># dK / d theta = (dK / dl) * (dl / d theta)</span>
<span class="g g-Whitespace">    </span><span class="mi">405</span> <span class="c1"># theta = log(l) =&gt; dl / d (theta) = e^theta = l</span>
<span class="g g-Whitespace">    </span><span class="mi">406</span> <span class="c1"># dK / d theta = l * dK / dl</span>
<span class="g g-Whitespace">    </span><span class="mi">407</span> 
<span class="g g-Whitespace">    </span><span class="mi">408</span> <span class="c1"># dK / dL computation</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p>How we can see every model has different best hyperparamaters for every scenario of validation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for model in model_dict.keys():</span>
<span class="c1">#     for param in best_params[model]:</span>
<span class="c1">#         for key in param.keys():</span>
<span class="c1">#             print(key)</span>
<span class="c1">#             param[key[6:]] = param.pop(key)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we will train every model for each scenario, using (7,14,21,28) days as training dataset and the following day as validation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a list to store the trained models</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.discriminant_analysis</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_percentage_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">clone</span>


<span class="n">trained_models</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Iterate over each model and train them</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Training </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">])])</span>
    <span class="n">rmse_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mape_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">r2_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n_days</span> <span class="ow">in</span> <span class="n">number_of_days</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Training </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1"> with </span><span class="si">{</span><span class="n">n_days</span><span class="si">}</span><span class="s1"> days...&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dfWind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">n_days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">):</span>
            <span class="n">model_tmp</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;model_ready&#39;</span><span class="p">][</span><span class="n">number_of_days</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">n_days</span><span class="p">)])</span>
            <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;model&#39;</span><span class="p">])])</span>
            <span class="n">X_train</span> <span class="o">=</span> <span class="n">dfWind</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">n_days</span><span class="o">*</span><span class="mi">24</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Velocidad horario del viento (m/s)&#39;</span><span class="p">,</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">y_train</span> <span class="o">=</span> <span class="n">dfWind</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">n_days</span><span class="o">*</span><span class="mi">24</span><span class="p">][</span><span class="s1">&#39;Velocidad horario del viento (m/s)&#39;</span><span class="p">]</span>            
            <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
            <span class="n">X_valid</span> <span class="o">=</span> <span class="n">dfWind</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">n_days</span><span class="o">*</span><span class="mi">24</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="p">((</span><span class="n">n_days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">24</span><span class="p">)]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Velocidad horario del viento (m/s)&#39;</span><span class="p">,</span> <span class="s1">&#39;Fecha&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">y_valid</span> <span class="o">=</span> <span class="n">dfWind</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">n_days</span><span class="o">*</span><span class="mi">24</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="p">((</span><span class="n">n_days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">24</span><span class="p">)][</span><span class="s1">&#39;Velocidad horario del viento (m/s)&#39;</span><span class="p">]</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_valid</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">)</span>
            <span class="n">y_true</span> <span class="o">=</span> <span class="n">y_valid</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid</span><span class="p">)</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">n_days</span><span class="p">][</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">n_days</span><span class="p">][</span><span class="s1">&#39;y_test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
            <span class="n">rmse_score</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
            <span class="n">mape_score</span> <span class="o">=</span> <span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
            <span class="n">r2_score_tmp</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
            <span class="n">rmse_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse_score</span><span class="p">)</span>
            <span class="n">mape_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mape_score</span><span class="p">)</span>
            <span class="n">r2_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r2_score_tmp</span><span class="p">)</span>
        <span class="c1"># Save the scores</span>
        <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;MAPE_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mape_scores</span><span class="p">))</span>
        <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;R2_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r2_scores</span><span class="p">))</span>
        <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;RMSE_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmse_scores</span><span class="p">))</span>
        <span class="n">rmse_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mape_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">r2_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">trained_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1"> trained!&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MAPE: </span><span class="si">{</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s2">&quot;MAPE_score&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;R2: </span><span class="si">{</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s2">&quot;R2_score&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RMSE: </span><span class="si">{</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s2">&quot;RMSE_score&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training Bayesan Ridge...
Training Bayesan Ridge with 7 days...
Bayesan Ridge trained!
MAPE: [73898798301139.05]
R2: [-0.06712612345592733]
RMSE: [1.2550013476282504]
Training Bayesan Ridge with 14 days...
Bayesan Ridge trained!
MAPE: [73898798301139.05, 68914432611756.83]
R2: [-0.06712612345592733, 0.26625958763597585]
RMSE: [1.2550013476282504, 0.7262360716599138]
Training Bayesan Ridge with 21 days...
Bayesan Ridge trained!
MAPE: [73898798301139.05, 68914432611756.83, 67492324032848.99]
R2: [-0.06712612345592733, 0.26625958763597585, 0.09949856424185008]
RMSE: [1.2550013476282504, 0.7262360716599138, 0.6554768651759865]
Training Bayesan Ridge with 28 days...
Bayesan Ridge trained!
MAPE: [73898798301139.05, 68914432611756.83, 67492324032848.99, 67383275300127.99]
R2: [-0.06712612345592733, 0.26625958763597585, 0.09949856424185008, 0.22216342362020222]
RMSE: [1.2550013476282504, 0.7262360716599138, 0.6554768651759865, 0.6075941838352815]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># File path to save the dictionary</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;../data/model_exo4_results.pkl&#39;</span>

<span class="c1"># Save the dictionary into a file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model_dict</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># Specify the path to the pickle file</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;../data/model_exo4_results.pkl&#39;</span>

<span class="c1"># Open the pickle file in read mode</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="c1"># Load the dictionary from the pickle file</span>
    <span class="n">dictionary</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="c1"># Now you can use the dictionary</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Bayesan Ridge&#39;: {&#39;model&#39;: BayesianRidge(), &#39;grid&#39;: {&#39;model__alpha_1&#39;: [1e-06, 1e-05, 0.0001, 0.001, 0.01, 0.1]}, &#39;MAPE_score&#39;: [73898798301139.05, 68914432611756.83, 67492324032848.99, 67383275300127.99], &#39;R2_score&#39;: [-0.06712612345592733, 0.26625958763597585, 0.09949856424185008, 0.22216342362020222], &#39;RMSE_score&#39;: [1.2550013476282504, 0.7262360716599138, 0.6554768651759865, 0.6075941838352815], &#39;model_ready&#39;: [BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, BayesianRidge())]),
              random_state=42,
              search_spaces={&#39;model__alpha_1&#39;: [1e-06, 1e-05, 0.0001, 0.001,
                                                0.01, 0.1]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, BayesianRidge())]),
              random_state=42,
              search_spaces={&#39;model__alpha_1&#39;: [1e-06, 1e-05, 0.0001, 0.001,
                                                0.01, 0.1]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, BayesianRidge())]),
              random_state=42,
              search_spaces={&#39;model__alpha_1&#39;: [1e-06, 1e-05, 0.0001, 0.001,
                                                0.01, 0.1]}), BayesSearchCV(cv=5,
              estimator=Pipeline(steps=[(&#39;scaler&#39;, StandardScaler()),
                                        (&#39;model&#39;, BayesianRidge())]),
              random_state=42,
              search_spaces={&#39;model__alpha_1&#39;: [1e-06, 1e-05, 0.0001, 0.001,
                                                0.01, 0.1]})]}}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_dict</span> <span class="o">=</span> <span class="n">dictionary</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_df_scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">model_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">list_r2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">list_mape</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">list_rmse</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">min_rmse</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">number_of_days</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">model_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">list_r2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;R2_score&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">list_mape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;MAPE_score&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">list_rmse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;RMSE_score&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;RMSE_score&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_rmse</span><span class="p">):</span>
            <span class="n">num_days</span> <span class="o">=</span> <span class="n">number_of_days</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">min_rmse</span> <span class="o">=</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;RMSE_score&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">best_model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="n">df_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Model&#39;</span><span class="p">:</span> <span class="n">model_names</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">list_r2</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">list_mape</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">list_rmse</span><span class="p">})</span>
    <span class="n">list_mape</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">list_r2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">list_rmse</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">list_df_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">number_of_days</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of days: </span><span class="si">{</span><span class="n">number_of_days</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">list_df_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of days: 7
        Model        R2         MAPE     RMSE
Bayesan Ridge -0.067126 7.389880e+13 1.255001
Number of days: 14
        Model      R2         MAPE     RMSE
Bayesan Ridge 0.26626 6.891443e+13 0.726236
Number of days: 21
        Model       R2         MAPE     RMSE
Bayesan Ridge 0.099499 6.749232e+13 0.655477
Number of days: 28
        Model       R2         MAPE     RMSE
Bayesan Ridge 0.222163 6.738328e+13 0.607594
</pre></div>
</div>
</div>
</div>
<p>Let’s analize the RMSE results to find the best model and the best training set:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_df_scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">list_rmse</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">number_of_days</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  
        <span class="n">list_rmse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="s1">&#39;RMSE_score&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;RMSE_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number_of_days</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">df_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Model&#39;</span><span class="p">:</span> <span class="n">model_names</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">list_rmse</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">name</span><span class="p">:</span> <span class="n">list_rmse</span><span class="p">})</span>
    <span class="n">list_df_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_scores</span><span class="p">)</span>
    <span class="n">list_rmse</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_df_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_scores</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model</th>
      <th>RMSE_7</th>
      <th>RMSE_14</th>
      <th>RMSE_21</th>
      <th>RMSE_28</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Bayesan Ridge</td>
      <td>1.255001</td>
      <td>0.726236</td>
      <td>0.655477</td>
      <td>0.607594</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The best model is </span><span class="si">{</span><span class="n">best_model</span><span class="si">}</span><span class="s1"> with a RMSE of </span><span class="si">{</span><span class="n">min_rmse</span><span class="si">}</span><span class="s1">, and </span><span class="si">{</span><span class="n">num_days</span><span class="si">}</span><span class="s1"> days of training&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The best model is Bayesan Ridge with a RMSE of 0.6075941838352815, and 28 days of training
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot the best model results</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">results_dict</span><span class="p">[</span><span class="n">best_model</span><span class="p">][</span><span class="n">num_days</span><span class="p">][</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">results_dict</span><span class="p">[</span><span class="n">best_model</span><span class="p">][</span><span class="n">num_days</span><span class="p">][</span><span class="s1">&#39;y_test&#39;</span><span class="p">]</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="o">-</span><span class="mi">500</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">[</span><span class="o">-</span><span class="mi">500</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Best model: </span><span class="si">{</span><span class="n">best_model</span><span class="si">}</span><span class="s1"> with </span><span class="si">{</span><span class="n">num_days</span><span class="si">}</span><span class="s1"> days of training&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c70daf2c2dfbd0e4e3757b52eddd15c807b885cdb7b6acbbda09f32269a6cc48.png" src="_images/c70daf2c2dfbd0e4e3757b52eddd15c807b885cdb7b6acbbda09f32269a6cc48.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="exo3.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Load data</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-dataset-already-processed">Loading Dataset, already processed</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-models-and-their-parameters">Defining models and their parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tuning-models-and-training-them">Tuning models and training them</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>